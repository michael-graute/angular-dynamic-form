<div class="form-control">
  <div class="selection-display-wrapper" (click)="toggleDataList()">
    <span class="current-selection">
      @if (loading) {
        <i class="bi-hourglass-split"></i> Loading...
      } @else if (error) {
        <i class="bi-exclamation-triangle text-danger"></i> Error loading options
      } @else if (selectedOption) {
        {{getDisplayLabel()}}
      } @else {
        <span class="text-muted">Select an option...</span>
      }
    </span>
    <i class="bi-chevron-down"></i>
  </div>
</div>
@if (showDataList && !loading && !error) {
  <div class="data-display">
    @if (shouldUseVirtualScroll()) {
      <!-- Virtual scrolling for >100 options -->
      <cdk-virtual-scroll-viewport
        [itemSize]="ITEM_HEIGHT"
        [style.height.px]="VIEWPORT_HEIGHT"
        class="data-select-viewport">
        <ul class="list-group">
          <li
            *cdkVirtualFor="let dataset of options; trackBy: trackByOption"
            class="list-group-item"
            (click)="optionClicked(dataset)">
            {{getOptionLabel(dataset)}}
          </li>
        </ul>
      </cdk-virtual-scroll-viewport>
    } @else {
      <!-- Standard rendering for <=100 options -->
      <ul class="list-group">
        @for (dataset of options; track trackByOption($index, dataset)) {
          <li class="list-group-item" (click)="optionClicked(dataset)">{{getOptionLabel(dataset)}}</li>
        }
        @empty {
          <li class="list-group-item text-muted">No options available</li>
        }
      </ul>
    }
  </div>
}
@if (error) {
  <div class="text-danger small mt-1">
    <i class="bi-exclamation-circle"></i> {{error}}
  </div>
}
